# Self-Confidence Score Generating

Description:

The self-confidence score is used for initializing the confidence score of `uncertain` state for each unknown function in RevDecode.
It is generated by matching unknown function with itself.

## Steps Overview

1. Unknown Binary Database Construction
2. Self-Confidence Score Generation
3. Self-Confidence Score Normalization

## 1. Unknown Binary Database Construction

### Tool: BSim

Description:
Create a Ghidra project to import and analyze binaries used for matching unknown functions in the unknown binary against any corpus functions.
And create a BSim database to contain these binaries for self-confidence score generation.

Usage:
```bash
mkdir -p /workspace/unknown-binary/ghidra-project \
         /workspace/unknown-binary/bsim-database \
         /workspace/unknown-binary/signatures &&
analyzeHeadless /workspace/unknown-binary/ghidra-project \
    postgres_object_files \
    -import /workspace/binaries/sample/* &&
bsim createdatabase file:/workspace/unknown-binary/bsim-database/unknown_binaries medium_nosize &&
bsim generatesigs \
    ghidra:/workspace/unknown-binary/ghidra-project/postgres_object_files \
    bsim="file:/workspace/unknown-binary/bsim-database/unknown_binaries" \
    /workspace/unknown-binary/signatures &&
bsim commitsigs \
    file:/workspace/unknown-binary/bsim-database/unknown_binaries \
    /workspace/unknown-binary/signatures
```

Output:
- A Ghidra project under `/workspace/unknown-binary/ghidra-project` containing the imported unknown binary.
- A list of `sig_` files under `/workspace/unknown-binary/signatures` directory, each containing XML contents including binary inforation and hashed features of the functions in the unknown binary.
- A BSim database under `/workspace/unknown-binary/bsim-database/unknown_binaries` containing the signatures of the unknown binary.

## 2. Self-Confidence Score Generation

### Tool: run_bsim.py, self_confidence.py

Description:
Builds self-confidence scores for the sample binary using BSim by matching each unknown function with itself.

Usage:
```bash
python3 run_bsim.py --purpose self_confidence
```

Configuration in `run_bsim.py`:
- Set `ghidra_project` to `/workspace/unknown-binary/ghidra-project`.
- Set `sample_binary_set_binaries_path` to `/workspace/binary/sample`.

Configuration in `self_confidence.py`:
- Set `DATABASE_URL` to `file:/workspace/unknown-binary/bsim-database/unknown_binaries`.
- Set `OUTPUT_FILE_PATH` to `/workspace/unknown-binary/self-confidence-scores`.

Output:
Self-confidence scores will be stored in:
```
/workspace/unknown-binary/self-confidence-scores/
```
For each file in the directory, it contains the self-confidence scores for each unknown function in the corresponding unknown binary.

## 3. Self-Confidence Score Normalization

### Tool: normalize_self_confidence.py

Description:
Collect self-confidence scores from multiple files and normalize them using sigmoid normalization.
And calculate the initial confidence score for the `uncertain` state of each unknown function in RevDecode.

Usage:
```bash
python3 normalize_self_confidence.py \
    --input_file_path /workspace/unknown-binary/self-confidence-scores \
    --output_file_path /workspace/unknown-binary/normalized_self_confidence_scores.json
```

Output:
Normalized self-confidence scores will be stored in:
```
/workspace/unknown-binary/normalized_self_confidence_scores.json
```
This file contains the normalized self-confidence scores for each unknown function in the unknown binary, and corresponding initial confidence scores for the `uncertain` state in RevDecode.
